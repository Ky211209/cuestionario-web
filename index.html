<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuizEli - Simulador Acad√©mico</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <header>
        <div class="logo">
            <i class="fa-solid fa-brain" style="color: #1a73e8;"></i>
            <h1>QuizEli <span class="subtitle">Acad√©mico</span></h1>
        </div>
        <div id="user-display" class="hidden" style="display: flex; align-items: center; gap: 10px;">
            <button id="btn-header-return" class="btn-back hidden"><i class="fas fa-arrow-left"></i> <span>Volver al Men√∫</span></button>
            <span id="user-info"></span>
            <button id="btn-logout" class="btn-secondary">Cerrar Sesi√≥n</button>
        </div>
    </header>

    <div class="container" id="auth-screen">
        <h2>Bienvenido</h2>
        <button id="btn-login" class="btn-primary" style="margin-top: 20px;">Acceder con Google</button>
    </div>

    <div class="container hidden" id="setup-screen">
        <!-- Tarjeta de bienvenida -->
        <div id="user-welcome-card" style="
            background: linear-gradient(135deg, #1a73e8, #1557b0);
            color: white;
            border-radius: 10px;
            padding: 12px 16px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            text-align: left;
        ">
            <i class="fas fa-user-circle" style="font-size: 2rem; opacity: 0.9; flex-shrink:0;"></i>
            <div style="min-width:0;">
                <div id="user-welcome-name" style="font-weight: 700; font-size: 0.95rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"></div>
                <div id="user-welcome-sub" style="font-size: 0.75rem; opacity: 0.8; margin-top: 2px;"></div>
            </div>
        </div>
        <div style="text-align: left; margin-bottom: 15px;">
            <label style="font-weight: bold; display: block; margin-bottom: 5px;">Materia</label>
            <select id="subject-select" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd;"></select>
        </div>
        <div style="text-align: left; margin-bottom: 15px;">
            <label style="font-weight: bold; display: block; margin-bottom: 5px;">Modo</label>
            <select id="mode-select" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd;">
                <option value="exam">üìù Examen (20 Preguntas)</option>
                <option value="study">üìö Estudio (Banco de preguntas)</option>
            </select>
        </div>

        <!-- TIEMPO: Examen ‚Üí 20/30/60 min | Estudio ‚Üí 20/30/60 min + Sin l√≠mite -->
        <div id="tiempo-container" style="text-align: left; margin-bottom: 15px;">
            <label style="font-weight: bold; display: block; margin-bottom: 5px;">‚è± Tiempo l√≠mite</label>
            <select id="tiempo-select" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd;">
                <option value="20">20 minutos</option>
                <option value="30">30 minutos</option>
                <option value="60">60 minutos</option>
                <!-- Esta opci√≥n solo se muestra en modo Estudio -->
                <option id="opcion-sin-limite" value="0" style="display:none;">‚ôæ Sin l√≠mite de tiempo</option>
            </select>
        </div>

        <!-- CANTIDAD: Solo visible en modo Estudio -->
        <div id="cantidad-container" style="text-align: left; margin-bottom: 20px; display: none;">
            <label style="font-weight: bold; display: block; margin-bottom: 5px;">üìã Cantidad de preguntas</label>
            <select id="cantidad-select" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd;">
                <option value="20">20 preguntas</option>
                <option value="todas">Todas las preguntas</option>
            </select>
        </div>

        <button id="btn-start" class="btn-primary" disabled>Selecciona una materia</button>
        <p id="admin-link-container" class="hidden" style="display: none;"><a href="admin.html" style="font-size: 0.8rem; color: #888; text-decoration: none; margin-top: 15px; display: inline-block;">Panel Administrativo</a></p>
    </div>

    <div class="container hidden" id="quiz-screen">
        <div style="display: flex; justify-content: flex-end; align-items: center; gap: 8px; margin-bottom: 15px;">
            <span id="timer-label" style="font-size: 0.85rem; color: #888; display: none;"></span>
            <div id="timer-display" style="font-weight: bold; color: #d93025; font-size: 1.1rem;">00:00</div>
        </div>
        <div id="question-text" style="font-weight: bold; text-align: left; margin-bottom: 20px; font-size: 1.1rem;"></div>
        <div id="options-container"></div>
    </div>

    <script type="module" src="script.js"></script>
    <script type="module">
        import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getAuth, signInWithRedirect, getRedirectResult, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

        const isMobile = /Android|iPhone|iPad|iPod|Opera Mini|IEMobile|WPDesktop/i.test(navigator.userAgent);
        if (isMobile) {
            // Reutilizar la instancia de Firebase ya iniciada por script.js
            const firebaseConfig = { apiKey: "AIzaSyAMQpnPJSdicgo5gungVOE0M7OHwkz4P9Y", authDomain: "autenticacion-8faac.firebaseapp.com", projectId: "autenticacion-8faac", storageBucket: "autenticacion-8faac.firebasestorage.app", appId: "1:939518706600:web:d28c3ec7de21da8379939d" };
            const app = getApps().length ? getApps()[0] : initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const provider = new GoogleAuthProvider();
            provider.setCustomParameters({ prompt: 'select_account' });

            // Procesar resultado al volver de Google
            getRedirectResult(auth).catch(e => console.warn('redirect result:', e?.code));

            // Esperar a que script.js cargue y sobreescribir el bot√≥n
            window.addEventListener('DOMContentLoaded', () => {
                setTimeout(() => {
                    const btn = document.getElementById('btn-login');
                    if (btn) {
                        btn.onclick = () => {
                            btn.textContent = 'Redirigiendo a Google...';
                            btn.disabled = true;
                            signInWithRedirect(auth, provider).catch(err => {
                                btn.textContent = 'Acceder con Google';
                                btn.disabled = false;
                                console.error('redirect error:', err);
                            });
                        };
                    }
                }, 800);
            });
        }
    </script>
</body>
</html>
